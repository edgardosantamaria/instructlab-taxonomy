---
created_by: tomjelinek
seed_examples:
  - question: |
      List resource groups from the given CIB.
    # yamllint disable rule:line-length
    context: |
      <cib crm_feature_set="3.19.0" validate-with="pacemaker-3.9" epoch="16" num_updates="33" admin_epoch="0" cib-last-written="Fri Mar  8 14:22:46 2024" update-origin="rh93-node1" update-client="root" update-user="root" have-quorum="1" dc-uuid="1">
        <configuration>
          <crm_config>
            <cluster_property_set id="cib-bootstrap-options">
              <nvpair id="cib-bootstrap-options-have-watchdog" name="have-watchdog" value="false"/>
              <nvpair id="cib-bootstrap-options-dc-version" name="dc-version" value="2.1.7-4.el9-c3ca950"/>
              <nvpair id="cib-bootstrap-options-cluster-infrastructure" name="cluster-infrastructure" value="corosync"/>
              <nvpair id="cib-bootstrap-options-cluster-name" name="cluster-name" value="rh93"/>
            </cluster_property_set>
          </crm_config>
          <nodes>
            <node id="1" uname="rh93-node1"/>
          </nodes>
          <resources>
            <primitive id="xvm" class="stonith" type="fence_xvm">
              <instance_attributes id="xvm-instance_attributes">
                <nvpair id="xvm-instance_attributes-pcmk_host_list" name="pcmk_host_list" value="rh93-node1,rh93-node2,rh93-node3"/>
              </instance_attributes>
              <operations>
                <op name="monitor" interval="60s" id="xvm-monitor-interval-60s"/>
              </operations>
            </primitive>
            <primitive id="Public-IP" class="ocf" type="IPaddr" provider="heartbeat">
              <instance_attributes id="params-public-ip">
                <nvpair id="public-ip-addr" name="ip" value="192.0.2.2"/>
              </instance_attributes>
            </primitive>
            <primitive id="Mailserver" class="lsb" type="exim"/>
          </resources>
          <constraints/>
          <rsc_defaults>
            <meta_attributes id="build-resource-defaults">
              <nvpair id="build-resource-stickiness" name="resource-stickiness" value="1"/>
            </meta_attributes>
          </rsc_defaults>
        </configuration>
      </cib>
    # yamllint enable rule:line-length
    answer: |
      There are no resource groups defined in the CIB.

  - question: |
      What are the resource groups in this CIB?
    # yamllint disable rule:line-length
    context: |
      <cib crm_feature_set="3.19.0" validate-with="pacemaker-3.9" epoch="22" num_updates="2" admin_epoch="0" cib-last-written="Fri Mar  8 14:27:56 2024" update-origin="rh93-node1" update-client="root" update-user="root" have-quorum="1" dc-uuid="1">
        <configuration>
          <crm_config>
            <cluster_property_set id="cib-bootstrap-options">
              <nvpair id="cib-bootstrap-options-have-watchdog" name="have-watchdog" value="false"/>
              <nvpair id="cib-bootstrap-options-dc-version" name="dc-version" value="2.1.7-4.el9-c3ca950"/>
              <nvpair id="cib-bootstrap-options-cluster-infrastructure" name="cluster-infrastructure" value="corosync"/>
              <nvpair id="cib-bootstrap-options-cluster-name" name="cluster-name" value="rh93"/>
            </cluster_property_set>
          </crm_config>
          <nodes>
            <node id="1" uname="rh93-node1"/>
          </nodes>
          <resources>
            <primitive id="xvm" class="stonith" type="fence_xvm">
              <instance_attributes id="xvm-instance_attributes">
                <nvpair id="xvm-instance_attributes-pcmk_host_list" name="pcmk_host_list" value="rh93-node1,rh93-node2,rh93-node3"/>
              </instance_attributes>
              <operations>
                <op name="monitor" interval="60s" id="xvm-monitor-interval-60s"/>
              </operations>
            </primitive>
            <group id="Email">
              <primitive id="Public-IP" class="ocf" type="IPaddr" provider="heartbeat">
                <instance_attributes id="params-public-ip">
                  <nvpair id="public-ip-addr" name="ip" value="192.0.2.2"/>
                </instance_attributes>
              </primitive>
              <primitive id="Mailserver" class="lsb" type="exim"/>
            </group>
            <group id="intranet">
              <primitive id="my_lvm" class="ocf" type="LVM-activate" provider="heartbeat">
                <instance_attributes id="my_lvm-instance_attributes">
                  <nvpair id="my_lvm-instance_attributes-vg_access_mode" name="vg_access_mode" value="system_id"/>
                  <nvpair id="my_lvm-instance_attributes-vgname" name="vgname" value="my_vg"/>
                </instance_attributes>
                <operations>
                  <op name="monitor" interval="30s" timeout="90s" id="my_lvm-monitor-interval-30s"/>
                  <op name="start" interval="0s" timeout="90s" id="my_lvm-start-interval-0s"/>
                  <op name="stop" interval="0s" timeout="90s" id="my_lvm-stop-interval-0s"/>
                </operations>
              </primitive>
              <primitive id="my_fs" class="ocf" type="Filesystem" provider="heartbeat">
                <instance_attributes id="my_fs-instance_attributes">
                  <nvpair id="my_fs-instance_attributes-device" name="device" value="/dev/my_vg/my_lv"/>
                  <nvpair id="my_fs-instance_attributes-directory" name="directory" value="/var/www"/>
                  <nvpair id="my_fs-instance_attributes-fstype" name="fstype" value="xfs"/>
                </instance_attributes>
                <operations>
                  <op name="monitor" interval="20s" timeout="40s" id="my_fs-monitor-interval-20s"/>
                  <op name="start" interval="0s" timeout="60s" id="my_fs-start-interval-0s"/>
                  <op name="stop" interval="0s" timeout="60s" id="my_fs-stop-interval-0s"/>
                </operations>
              </primitive>
              <primitive id="VirtualIP" class="ocf" type="IPaddr2" provider="heartbeat">
                <instance_attributes id="VirtualIP-instance_attributes">
                  <nvpair id="VirtualIP-instance_attributes-cidr_netmask" name="cidr_netmask" value="24"/>
                  <nvpair id="VirtualIP-instance_attributes-ip" name="ip" value="198.51.100.3"/>
                </instance_attributes>
                <operations>
                  <op name="monitor" interval="10s" timeout="20s" id="VirtualIP-monitor-interval-10s"/>
                  <op name="start" interval="0s" timeout="20s" id="VirtualIP-start-interval-0s"/>
                  <op name="stop" interval="0s" timeout="20s" id="VirtualIP-stop-interval-0s"/>
                </operations>
              </primitive>
              <primitive id="Website" class="ocf" type="apache" provider="heartbeat">
                <instance_attributes id="Website-instance_attributes">
                  <nvpair id="Website-instance_attributes-configfile" name="configfile" value="/etc/httpd/conf/httpd.conf"/>
                  <nvpair id="Website-instance_attributes-statusurl" name="statusurl" value="http://127.0.0.1/server-status"/>
                </instance_attributes>
                <operations>
                  <op name="monitor" interval="10s" timeout="20s" id="Website-monitor-interval-10s"/>
                  <op name="start" interval="0s" timeout="40s" id="Website-start-interval-0s"/>
                  <op name="stop" interval="0s" timeout="60s" id="Website-stop-interval-0s"/>
                </operations>
              </primitive>
            </group>
          </resources>
          <constraints/>
          <rsc_defaults>
            <meta_attributes id="build-resource-defaults">
              <nvpair id="build-resource-stickiness" name="resource-stickiness" value="1"/>
            </meta_attributes>
          </rsc_defaults>
        </configuration>
      </cib>
    # yamllint enable rule:line-length
    answer: |
      This CIB contains two resource groups:
      1. Resource group "Email" with resources:
        - Public-IP (ocf:heartbeat:IPaddr)
        - Mailserver (lsb:exim)
      2. Resource group "intranet" contains resources:
        - my_lvm (ocf:heartbeat:LVM-activate)
        - my_fs (ocf:heartbeat:Filesystem)
        - VirtualIP (ocf:heartbeat:IPaddr2)
        - Website (ocf:heartbeat:apache)

  - question: |
      List resource groups and their resources from the provided CIB.
    # yamllint disable rule:line-length
    context: |
      <cib crm_feature_set="3.19.0" validate-with="pacemaker-3.9" epoch="30" num_updates="5" admin_epoch="0" cib-last-written="Fri Mar  8 14:36:51 2024" update-origin="rh93-node1" update-client="root" update-user="root" have-quorum="1" dc-uuid="1">
        <configuration>
          <crm_config>
            <cluster_property_set id="cib-bootstrap-options">
              <nvpair id="cib-bootstrap-options-have-watchdog" name="have-watchdog" value="false"/>
              <nvpair id="cib-bootstrap-options-dc-version" name="dc-version" value="2.1.7-4.el9-c3ca950"/>
              <nvpair id="cib-bootstrap-options-cluster-infrastructure" name="cluster-infrastructure" value="corosync"/>
              <nvpair id="cib-bootstrap-options-cluster-name" name="cluster-name" value="rh93"/>
            </cluster_property_set>
          </crm_config>
          <nodes>
            <node id="1" uname="rh93-node1"/>
          </nodes>
          <resources>
            <primitive id="xvm" class="stonith" type="fence_xvm">
              <instance_attributes id="xvm-instance_attributes">
                <nvpair id="xvm-instance_attributes-pcmk_host_list" name="pcmk_host_list" value="rh93-node1,rh93-node2,rh93-node3"/>
              </instance_attributes>
              <operations>
                <op name="monitor" interval="60s" id="xvm-monitor-interval-60s"/>
              </operations>
            </primitive>
            <group id="Email">
              <primitive id="Public-IP" class="ocf" type="IPaddr" provider="heartbeat">
                <instance_attributes id="params-public-ip">
                  <nvpair id="public-ip-addr" name="ip" value="192.0.2.2"/>
                </instance_attributes>
              </primitive>
              <primitive id="Mailserver" class="lsb" type="exim"/>
            </group>
            <clone id="locking-clone">
              <group id="locking">
                <primitive id="dlm" class="ocf" type="controld" provider="pacemaker">
                  <operations>
                    <op name="monitor" interval="30s" id="dlm-monitor-interval-30s"/>
                    <op name="start" interval="0s" timeout="90s" id="dlm-start-interval-0s"/>
                    <op name="stop" interval="0s" timeout="100s" id="dlm-stop-interval-0s"/>
                  </operations>
                </primitive>
                <primitive id="lvmlockd" class="ocf" type="lvmlockd" provider="heartbeat">
                  <operations>
                    <op name="monitor" interval="30s" id="lvmlockd-monitor-interval-30s"/>
                    <op name="start" interval="0s" timeout="90s" id="lvmlockd-start-interval-0s"/>
                    <op name="stop" interval="0s" timeout="90s" id="lvmlockd-stop-interval-0s"/>
                  </operations>
                </primitive>
              </group>
              <meta_attributes id="locking-clone-meta_attributes">
                <nvpair id="locking-clone-meta_attributes-interleave" name="interleave" value="true"/>
              </meta_attributes>
            </clone>
          </resources>
          <constraints/>
          <rsc_defaults>
            <meta_attributes id="build-resource-defaults">
              <nvpair id="build-resource-stickiness" name="resource-stickiness" value="1"/>
            </meta_attributes>
          </rsc_defaults>
        </configuration>
      </cib>
    # yamllint enable rule:line-length
    answer: |
      There are two resource group defined:
      1. Resource group "Email" containing resources:
        - Public-IP (ocf:heartbeat:IPaddr)
        - Mailserver (lsb:exim)
      2. Resource group "locking" cloned as "locking-clone" with resources:
        - dlm (ocf:pacemaker:controld)
        - lvmlockd (ocf:heartbeat:lvmlockd)

task_description: |
  Extract resource groups from HA Cluster CIB file
